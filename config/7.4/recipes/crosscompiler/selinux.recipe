set -o errexit +o hashall

version 20131030
{
	depends musl-cross
	
	#include checkpolicy 2.2
	include libselinux 2.2.1
	#include libsemanage 2.2
	include libsepol 2.2
	#include policycoreutils 2.2.2
	#include sepolgen 1.2.1
}

# https://bugzilla.redhat.com/show_bug.cgi?id=214465
function install_crosscompiler_selinux()
{
	pushd libsepol >/dev/null
		
		LFS_CFLAGS_PRE="-v" LFS_CXXFLAGS_PRE="-v" makePackageInsideDependencyFolder external-crosscompiler-gcc external-crosscompiler-g++ DESTDIR="$LFS_DEPENDENCY_INSTALL_PATH"
	
	popd  >/dev/null
	
	pushd libselinux >/dev/null

		# PROBLEM: Does not create a static archive combined with libsepol
		export MAKEFLAGS="-j1"
		
		mkdir -m 0755 -p "$LFS_DEPENDENCY_INSTALL_PATH"/x86_64-linux-musl/usr/include

		# -Werror removed as causes failure of compilation of booleans.c
		LFS_CFLAGS_PRE="-v" \
		LFS_CXXFLAGS_PRE="-v" \
		CFLAGS="-Wall -W -Wundef -Wformat-y2k -Wformat-security -Winit-self -Wmissing-include-dirs -Wunused -Wunknown-pragmas -Wstrict-aliasing -Wshadow -Wpointer-arith -Wbad-function-cast -Wcast-align -Wwrite-strings -Wlogical-op -Waggregate-return -Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes -Wmissing-declarations -Wmissing-noreturn -Wmissing-format-attribute -Wredundant-decls -Wnested-externs -Winline -Winvalid-pch -Wvolatile-register-var -Wdisabled-optimization -Wbuiltin-macro-redefined -Wmudflap -Wpacked-bitfield-compat -Wsync-nand -Wattributes -Wcoverage-mismatch -Wmultichar -Wcpp -Wdeprecated-declarations -Wdiv-by-zero -Wdouble-promotion -Wendif-labels -Wextra -Wformat-contains-nul -Wformat-extra-args -Wformat-zero-length -Wformat=2 -Wmultichar -Wnormalized=nfc -Woverflow -Wpointer-to-int-cast -Wpragmas -Wsuggest-attribute=const -Wsuggest-attribute=noreturn -Wsuggest-attribute=pure -Wtrampolines -Wno-missing-field-initializers -Wno-sign-compare -Wjump-misses-init -Wno-format-nonliteral -Wframe-larger-than=32768 -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-all --param=ssp-buffer-size=4 -fexceptions -fasynchronous-unwind-tables -fdiagnostics-show-option -funit-at-a-time -fipa-pure-const -Wno-suggest-attribute=pure -Wno-suggest-attribute=const -Wno-aggregate-return -Wno-redundant-decls" \
		makePackageInsideDependencyFolder external-crosscompiler-gcc external-crosscompiler-g++ DESTDIR="$LFS_DEPENDENCY_INSTALL_PATH"
	
	popd  >/dev/null
}
