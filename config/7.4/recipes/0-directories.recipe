
# LSB only requires 0 and 1
# Debian usses 65534 for nobody
# debian uses 65534 for nogroup
# 5 is needed by us for tty and we also use utmp

system_group root 0 
user root "root" /root /bin/bash 0 root

system_group bin 1
user bin "bin" /dev/null /bin/false 1 bin

system_group nogroup 99
user nobody "Unpriveleged User" /dev/null /bin/false 99 nogroup

system_group sys 2
system_group kmem 3
system_group tape 4
system_group tty 5
system_group daemon 6

system_group floppy 7
system_group disk 8
system_group lp 9
system_group dialout 10
system_group audio 11
system_group video 12

system_group utmp 13

system_group usb 14
system_group cdrom 15
system_group mail 34

# consider system_group www-data

# Before attributes
#  D - sync directory
#  T - top-level for hashing and Orlov block allocator (esp /home)
#  j - ensure journaled
#  S - ensure file sync'd

# After attributes
# a - append only (add files/folders for a folder)
# i - immutable (not further changes to file / folder)

# Attributes don't seem to work for anything other than folders or files

directory / 0755 root root D ai

		local -r stdoutLog="$systemLogsPath"/minimal-filesystem.stdout.log
		local -r stderrLog="$systemLogsPath"/minimal-filesystem.stderr.log
		mkdir -v -m 0755 -p "$LFS"/{dev,proc,sys} 1>"$stdoutLog" 2>"$stderrLog"
	
		# Required by the kernel to boot before udevd is started
		mknod -m 600 "$LFS"/dev/console c 5 1 1>>"$stdoutLog" 2>>"$stderrLog"
		mknod -m 666 "$LFS"/dev/null c 1 3 1>>"$stdoutLog" 2>>"$stderrLog"
		
directory /dev 0755 root root DT ''
directory /proc 0755 root root DT ''
directory /sys 0755 root root DT ''

# Required by the kernel to boot before udevd is started
make_character_device /dev/console 5 1 600 root root
make_character_device /dev/null 1 3 666 root root

# What about 'd', no dump?
# requires e2fsprogs in the toolchain

# a makes folders only allow creation; i makes them immutable
#mkdir -m 0755 -p /{bin,boot,etc/{opt,sysconfig},home,lib,mnt,opt,run}
directory /bin 0755 root root D ai
directory /boot 0755 root root D ai
directory /etc 0755 root root D ai
directory /etc/opt 0755 root root D ai
directory /etc/sysconfig 0755 root root D ai
directory /home 0755 root root DT ai
directory /lib 0755 root root D ai
directory /mnt 0755 root root DT ai
directory /opt 0755 root root DT ai
directory /run 0755 root root D ai
directory /srv 0755 root root DT ai
directory /usr 0755 root root DT ai
directory /usr/local 0755 root root DT ai

#mkdir -m 0755 -p /{media/{floppy,cdrom},sbin,srv,var}
directory /media 0755 root root D ai
#directory /media/floppy 0755 root root D ai
#directory /media/cdrom 0755 root root D ai
directory /sbin 0755 root root D ai
directory /srv 0755 root root DT ai
directory /var 0755 root root DT ai

#install -m 0750 --directory /root
directory /root 0750 root root '' D

#install -m 1777 --directory /tmp /var/tmp
directory /tmp 1777 root root '' D
directory /var/tmp 1777 root root '' D

#mkdir -m 0755 -p /usr/{,local/}{bin,include,lib,sbin,src}
directory /usr/bin 0755 root root D ai
directory /usr/include 0755 root root D ai
directory /usr/lib 0755 root root D ai
directory /usr/sbin 0755 root root D ai
directory /usr/src 0755 root root D ai
directory /usr/local/bin 0755 root root D ai
directory /usr/local/include 0755 root root D ai
directory /usr/local/lib 0755 root root D ai
directory /usr/local/sbin 0755 root root D ai
directory /usr/local/src 0755 root root D ai

#mkdir -m 0755 -p /usr/{,local/}share/{doc,info,locale,man}
directory /usr/share/doc 0755 root root D ai
directory /usr/share/info 0755 root root D ai
directory /usr/share/locale 0755 root root D ai
directory /usr/share/man 0755 root root D ai
directory /usr/local/share/doc 0755 root root D ai
directory /usr/local/share/info 0755 root root D ai
directory /usr/local/share/locale 0755 root root D ai
directory /usr/local/share/man 0755 root root D ai

#mkdir -m 0755 -p /usr/{,local/}share/{misc,terminfo,zoneinfo}
directory /usr/share/misc 0755 root root D ai
directory /usr/share/terminfo 0755 root root D ai
directory /usr/share/zoneinfo 0755 root root D ai
directory /usr/local/share/misc 0755 root root D ai
directory /usr/local/share/terminfo 0755 root root D ai
directory /usr/local/share/zoneinfo 0755 root root D ai

#directory /usr/share/dict 0755 root root D ai
#directory /usr/local/share/dict 0755 root root D ai
#directory /usr/share/misc 0755 root root D ai
#directory /usr/local/share/misc 0755 root root D ai
#directory /usr/share/sgml 0755 root root D ai
#directory /usr/local/share/sgml 0755 root root D ai

#mkdir -m 0755 -p /usr/{,local/}share/man/man{1..8}
directory /usr/share/man/man1 0755 root root D ai
directory /usr/share/man/man2 0755 root root D ai
directory /usr/share/man/man3 0755 root root D ai
directory /usr/share/man/man4 0755 root root D ai
directory /usr/share/man/man5 0755 root root D ai
directory /usr/share/man/man6 0755 root root D ai
directory /usr/share/man/man7 0755 root root D ai
directory /usr/share/man/man8 0755 root root D ai
directory /usr/local/share/man/man1 0755 root root D ai
directory /usr/local/share/man/man2 0755 root root D ai
directory /usr/local/share/man/man3 0755 root root D ai
directory /usr/local/share/man/man4 0755 root root D ai
directory /usr/local/share/man/man5 0755 root root D ai
directory /usr/local/share/man/man6 0755 root root D ai
directory /usr/local/share/man/man7 0755 root root D ai
directory /usr/local/share/man/man8 0755 root root D ai

# this is target source, rather than ln -s source target
symlink /usr/man share/man
symlink /usr/doc share/doc
symlink /usr/info share/info
symlink /usr/local/man share/man
symlink /usr/local/doc share/doc
symlink /usr/local/info share/info

case "$(uname -m)" in
	x86_64)
		symlink /lib64 lib
		symlink /usr/lib64 lib
		symlink /usr/local/lib64 lib
	;;
esac

#mkdir -m 0755 -p /var/{log,mail,spool}
directory /var/log 0755 root root '' D
directory /var/mail 0755 root root '' D
directory /var/spool 0755 root root '' D

# ?
#directory /var/backups 0755 root root '' D

# Not widely used
#directory /var/account 0755 root root '' D
#directory /var/games 0755 root root '' D
#directory /var/yp 0755 root root '' D
#directory /var/crash 1777 root root '' D

symlink /var/run /run
symlink /var/lock /run/lock

directory /var/opt 0755 root root '' D
directory /var/cache 0755 root root '' D
directory /var/lib 0755 root root D ai
directory /var/lib/misc 0755 root root D ai
directory /var/lib/locate 0755 root root '' D
directory /var/local 0755 root root '' D

# Ensures that essential tools from the toolchain exist and are slowly replaced during the installation
#ln -sv /"$LFS_TOOLS"/bin/{bash,cat,echo,pwd,stty} /bin
#ln -sv /"$LFS_TOOLS"/bin/perl /usr/bin
#ln -sv /"$LFS_TOOLS"/lib/libgcc_s.so{,.1} /usr/lib
#ln -sv /"$LFS_TOOLS"/lib/libstdc++.so{,.6} /usr/lib
#ln -sv bash /bin/sh
symlink /bin/bash /"$LFS_TOOLS"/bin/bash
symlink /bin/cat /"$LFS_TOOLS"/bin/cat
symlink /bin/echo /"$LFS_TOOLS"/bin/echo
symlink /bin/pwd /"$LFS_TOOLS"/bin/pwd
symlink /bin/stty /"$LFS_TOOLS"/bin/stty
symlink /usr/bin/perl /"$LFS_TOOLS"/bin/perl
symlink /usr/lib/libgcc_s.so /"$LFS_TOOLS"/lib/libgcc_s.so
symlink /usr/lib/libgcc_s.so.1 /"$LFS_TOOLS"/lib/libgcc_s.so.1
symlink /usr/lib/libstdc++.so /"$LFS_TOOLS"/lib/libstdc++.so
symlink /usr/lib/libstdc++.so.6 /"$LFS_TOOLS"/lib/libstdc++.so.6
#See below: sed "s/"$LFS_TOOLS"/usr/" /"$LFS_TOOLS"/lib/libstdc++.la >/usr/lib/libstdc++.la
symlink bash /bin/sh

# historic mtab
#ln -sv /proc/self/mounts /etc/mtab
symlink /etc/mtab /proc/self/mounts

touch_file /var/log/btmp 600 root utmp jS ''
touch_file /var/log/utmp 600 root utmp jS ''
touch_file /var/log/lastlog 664 root utmp jS ''

function installPackage_system_0directories()
{
	local -r sedExpression="s/$LFS_TOOLS/usr/"
	sed "$sedExpression" /"$LFS_TOOLS"/lib/libstdc++.la >/usr/lib/libstdc++.la
	
	renderUsers >/etc/passwd
	chattr /etc/passwd aijS
	
	renderGroups >/etc/groups
	chattr /etc/groups aijS
	
	# Section 9.1
	echo "$LFS_DISTRIBUTION_VERSION" >/etc/lfs-release
	cat >/etc/lsb-release <<-EOF
		DISTRIB_ID="$LFS_DISTRIBUTION_ID"
		DISTRIB_RELEASE="$LFS_DISTRIBUTION_VERSION"
		DISTRIB_CODENAME="$LFS_DISTRIBUTION_CODENAME"
		DISTRIB_DESCRIPTION="$LFS_DISTRIBUTION_DESCRIPTION"
	EOF
}
