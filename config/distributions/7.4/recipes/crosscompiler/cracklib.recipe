set -o errexit +o hashall

version 2.9.0
{
	depends musl-cross
	include config "${settings_string[LFS_AUTOTOOLS_CONFIG_VERSION]}"
	include cracklib-words 20080507
	include cracklib-words-cotse 0
	
	# More wordlists:-
	# http://www.cyberwarzone.com/cyberwarfare/password-cracking-mega-collection-password-cracking-word-lists
	# http://wordlist.sourceforge.net/
	# http://www.openwall.com/wordlists/
	
	remove_unwanted . build
	
	remove_unwanted sbin \
		cracklib-format \
		cracklib-packer \
		create-cracklib-dict
	
	remove_unwanted share cracklib
	
	# no doc resources
	
	compile_resources . include
	
	compile_resources lib \
		libcrack.a \
		libcrack.la
	
	strip_unneeded lib \
		libcrack.so
	
	strip_unneeded sbin \
		cracklib-check \
		cracklib-unpacker
	
	install_system_binaries sbin \
		cracklib-check \
		cracklib-unpacker
}

function install_crosscompiler_cracklib()
{
	# http://www.linuxfromscratch.org/blfs/view/svn/postlfs/cracklib.html
	local -r emptyIncludeFolder="$muslCrossAbsoluteInstallPath"/"$LFS_FOREIGN_TRIPLE"/include
	
	# We need to compile twice, once for build host and once for install host

	buildUsingAutotoolsExternalForBuildServer callback_empty \
		--oldincludedir="$emptyIncludeFolder" \
		--enable-shared \
		--enable-static \
		--enable-fast-install \
		--disable-dependency-tracking \
		--disable-nls \
		--with-gnu-ld \
		--without-x \
		--without-libiconv-prefix \
		--without-libintl-prefix \
		--without-python \
		--with-default-dict="${LFS}${LFS_DEPENDENCY_PREFIX_PATH}"/build/lib/cracklib/pw_dict
	
	# We could install to /usr/share/dict, but what's the point?
	
	pushd ../../install/build/sbin >/dev/null
	
		create-cracklib-dict ../share/cracklib/cracklib-small ../../../source/cracklib-words/file ../../../source/cracklib-words-cotse/*
		
	popd >/dev/null
	
	pushdDependencyFolder
	
		make clean
	
	popdDependencyFolder
	
	buildUsingAutotoolsExternal callback_empty \
		--oldincludedir="$emptyIncludeFolder" \
		--enable-shared \
		--enable-static \
		--enable-fast-install \
		--disable-dependency-tracking \
		--disable-nls \
		--with-gnu-ld \
		--without-x \
		--without-libiconv-prefix \
		--without-libintl-prefix \
		--without-python \
		--with-default-dict="$LFS_DEPENDENCY_PREFIX_PATH"/lib/cracklib/pw_dict
}
